# 이벤트 다루기

1. 이벤트
   - 웹 브라우저가 프로그램에 알리는 사건의 발생이다.
2. 이벤트 타입
   - 발생한 이벤트의 종류를 나타내는 문자열이다.
3. 이벤트 타깃
   - 이벤트가 발생한 객체 혹은 이벤트와 연관된 객체다.
   - 이벤트에 대해서 말할 때, 반드시 타입과 타깃 모두를 명시해야 한다.
4. 이벤트 핸들러, 이벤트 리스너
   - 이벤트에 응답하거나 이벤트를 다룰 함수를 말한다.
   - 애플리케이션은 웹브라우저에 이벤트 타입과 이벤트 타깃을 지정하여 이벤트 핸들러 함수를 등록한다. 특정 타입의 이벤트가 특정 타깃에서 발생할 때, 브라우저는 핸들러를 실행한다.
5. 이벤트 객체
   - 특정 이벤트와 연관된 객체로, 해당 이벤트의 상세 내용을 담고 있다.
   - 이벤트 객체는 이벤트 핸들러 함수에 전달인자로 전달된다.
   - 모든 이벤트 객체에는 이벤트 타입을 나타내는 type 프로퍼티와 이벤트 타깃을 나타내는 target 프로퍼티가 존재한다.
   - 각 이벤트 타압은 해당 타입과 관련된 이벤트 객체 안에 관련된 프로퍼티 모음을 정의한다.
     - 예를 들어, 마우스 이벤트와 관련된 이벤트 객체는 마우스 포인터의 좌표를 가진다.
6. 이벤트 전파(event propagation)
   - 이벤트가 발생했을 때, 브라우저가 이벤트 핸들러를 실행시킬 객체를 결정하는 과정이다.
   - **_버블링_**
     - 이벤트가 발생한 요소에서 시작하여, 이벤트가 문서 트리를 타고 올라가는 현상
   - **_캡처링_**
     - 실제 타깃 객체에 이벤트가 전달되기 전에 상위 컨테이너 요소에 정의된 이벤트 핸들러가 이를 가로막거나 잡아낼 수 있다.
   - 이벤트 핸들러는 이벤트 객체의 메서드 실행이나 프로퍼티 지정으로 이벤트 전파를 제어할 수 있다.
7. 기본동작(default action)
   - 몇 가지 이벤트는 기본 동작을 가지고 있다. 예를 들어서, click 이벤트가 하이퍼링크에서 발생할 때는 브라우저가 링크를 따라가서 새 페이지를 여는 것이 기본 동작이다. 하지만 이런 이벤트의 기본 동작은 **_적절한 값을 반환하거나, 이벤트 객체의 메서드를 호출하거나, 이벤트 객체의 프로퍼티를 지정해서 막을 수 있다._**. 흔히 이벤트 취소(canceling)이라 부른다.

# 이벤트 핸들러 호출

### 1. 이벤트 핸들러의 유효범위

1. 모든 자바스크립트의 함수처럼, 이벤트 핸들러는 유효범위가 **_정적(lexically scope)_**이다. 핸들러는 호출된 위치가 아닌 정의된 위치의 유효범위 안에서 실행된다. 그리고 이 유효범위에 있는 모든 지역 변수에 접근할 수 있다.
2. 하지만 HTML 속성으로 등록한 이벤트 핸들러는 예외다. 이렇게 등록된 핸들러는 어딘가의 지역 변수가 아닌 전역 변수에 접근할 수 있는 최상위 함수로 변환된다.

### 2. 핸들러의 반환 값

객체의 프로퍼티나 HTML 속성으로 등록된 이벤트 핸들러의 반환 값은 때로는 중요한 의미를 지닌다.

1. 반환 값이 false
   - 브라우저가 이벤트와 관련된 기본 동작을 중지한다.
   - 객체의 프로퍼티나 HTML 속성으로 등록된 핸들러에서만 의미가 있다.
2. 이벤트 객체의 preventDefault(), returnValue 프로퍼티
   - addEventListener()로 등록 된 이벤트 핸들러에서 기본 동작을 중지할 때 사용한다.

### 3. 호출순서

문서 내 요소나 객체는 한 이벤트 타입에 여러 개의 이벤트 핸들러를 등록할 수 있다.
적절한 이벤트가 발생할 때, 브라우저는 다음 실행 순서에 따라 모든 핸들러를 호출한다.

1. 객체의 프로퍼티와 HTML 속성으로 등록된 핸들러가 존재하면 가장 먼저 호출한다.
2. addEventListener()로 등록한 핸들러는 등록된 순서대로 호출한다.
3. attachEvent()로 등록한 핸들러는 알 수 없는 순서로 실행되므로 코드를 순차 실행에 의존하면 안된다.

### 4. 이벤트 전파

1. 버블링
   - 이벤트 타깃이 Docuemnt 객체 혹은 문서 요소라면 타깃 객체에 등록된 이벤트 핸들러가 실행된 후에, 대부분의 이벤트는 DOM 계층 구조를 따라서 타고 올라간다.
   - 타깃 객체의 부모 객체에 등록된 이벤트 핸들러가 호출되고 다시 그 부모 객체에 등록된 핸들러가 호출된다. 이런 과정은 Docuemnt 객체를 지나서 Window 객체까지 이어진다.
   - focus,blur, scroll 이벤트는 예외다.
2. 캡처링
   - addEventListener()는 세 번째 전달인자로 불리언 값을 가지는데, 이 전달인자가 true이면 이벤트 핸들러는 이벤트 전파 단계에서 가장 먼저 호출되는 캡처링 이벤트 핸들러로 등록된다.
   - Window 객체의 캡처링 핸들러가 맨 처음 호출되고, Document 객체의 캡처링 핸들러가 그 다음 호출되며, body 객체가 그 다음에 호출되는 식으로, 이벤트 타깃으로 지정한 객체의 부모의 이벤트 핸들러가 캡처링 될 때까지 DOM 계층 구조를 타고 내려간다. 이벤트 타깃에 등록된 캡처링 이벤트 핸들러는 호출되지 않는다.

### 5. 이벤트 취소

1. 기본 동작 취소

   - ```
        function cancelHandler(event) {
            var event = event || window.event //IE를 위해서

            //이벤트와 관련된 기본 동작을 취소한다.
            if(event.preventDefault) event.preventDefault(); //표준 기법
            if(event.returnValue) event.returnValeu = false; //IE의 기법
            return false; //타깃 객체의 프로퍼티로 등록된 핸드러를 위해서 반환 값 설정
        }
     ```

2. 이벤트 전파 취소
   - stopPropagation() 메서드가 이벤트 객체에 존재한다.
     - 동일 객체에 등록된 다른 핸들러가 있다면, stopPropagation() 메서드를 호출한 후 나머지 핸들러가 호출되지만, 다른 객체에 있는 이벤트 핸들러는 이벤트 전파를 멈추었으므로 호출되지 안흔ㄴ다.
   - stopImmediatePropagation() 메서드가 정의되어 있다.
     - 이벤트 전파되는 것을 막을 뿐 아니라, 동일 객체에 등록된 다른 이벤트 핸들러의 호출도 막는다.
