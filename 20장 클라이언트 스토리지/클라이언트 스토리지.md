# 클라이언트 스토리지

웹 애플리케이션은 사용자 컴퓨터에 데이터를 저장하지 위해 브라우저의 API를 사용할 수 있다. 이 클라이언트 스토리지는 웹브라우저에게 메모리를 제공한다.
예를 들면, **_웹 앱에서 사용자의 설정이나 특정한 상태까지도 저장할 수 있다. 그러므로 사용자가 재방문하면, 마지막 방문시의 상태를 정확히 복구할 수 있다._**
클라이언트 스토리지는 출처별로 분리되어 저장되므로, 한 사이트의 페이지에서 다른 사이트의 페이지에 저장된 데이터를 읽을 수는 없다. 그러나 두 페이지가 같은 사이트에 존재한다면 서로 스토리지를 공유할 수 있어 통신 메커니즘으로 활용할 수 있다.  
웹 애플리케이션은 저장된 데이터의 생명 주기를 설정할 수 있다. 데이터를 일시적으로만 저장되게 하여 창이 닫히거나 브라우저가 종료되기 전까지만 유효하게 하거나, 하드 드라이브에 영구적으로 저장할 수 있다. 물론, 월이나 연 단위 저장도 가능하다.

다음은 클라이언트 스토리지의 몇 가지 형태다.

1. 웹 스토리지

   - 이 API는 본질적으로 문자열 키와 값을 대응시킨 영속성 연관 배열인 로컬 스토리지와 세션 스토리지 객체로 구성되어 있다.
   - 웹 스토리지는 매우 사용하기 쉽고, 너무 크지 않은 대량의 데이터를 저장하기에 적합하다.

2. 쿠키

   - 쿠키는 서버 측에서 스크립팅 가능하도록 설계된 오래된 클라이언트 스토리지 메커니즘이다.
   - 쿠키를 사용하여 저장된 데이터는 클라이언트에서만 사용한다 하더라도 HTTP 요청시 항상 서버로 전송된다.

3. 오프라인 웹 애플리케이션

   - HTML5에서는 웹 페이지와 해당 페이지의 리소스(스크립트와 CSS파일, 이미지 등)를 캐시할 수 있게 해주는 '오프라인 웹 애플리케이션' API를 정의한다.
   - 이 API는 웹 애플리케이션을 위한 클라이언트 스토리지라기보다는, 데이터 그 자체이며, 이 API를 사용하면 웹 애플리케이션이 스스로 설치될 수 있으므로 인터넷에 연결되어 있지 않아도 사용 가능하다.

4. 웹 데이터베이스

   - 이 API는 조회 언어(query language)가 필요 없는 간단한 객체 기반 데이터베이스다.

5. 파일 시스템 API
   - 관련된 표준화 초안에서는 개인 로컬 파일 시스템의 제어권을 획득하여 해당 파일 시스템의 파일을 읽어 들이거나 쓸 수 있게 하는 API를 정의한다.

# 로컬 스토리지와 세션 스토리지

'웹 스토리지' 표준 초안을 구현하는 브라우저에는 Window 객체에 localStorage와 sessionStorage 프로퍼티가 추가로 정의되어 있다. 두 프로퍼티 모두 문자열 키에 값이 대응되어 있는 영속적 연관 배열인 Storage 객체를 가리킨다. Storage 객체는 간단히 객체에 문자열로 프로퍼티를 만들고 브라우저가 데이터를 저장하는 식으로, 정규 자바스크립트 객체와 매우 유사하게 동작한다. **_로컬 스토리지와 세션 스토리지의 차이점은 데이터를 얼마나 오래 보관할지를 결정하는 생명 주기와 접근 가능 대상의 지정범위이다._**

```
    //예시
    var name = localStorage.username; //저장된 값을 가져온다.
    name = localStorage['username']; //배열과 표기법이 동등하다.
    if(!name) {
        name = prompt('what is your name?'); //사용자에게 질문한다.
        localStorage.username = name; //사용자의 응답을 저장한다.
    }

    //저장된 모든 이름/값 쌍을 순회한다.
    for(var name in localStorage) {
        var value = localStorage[name];
    }

    //Storage 객체는 데이터를 저장하고 조회, 반복, 삭제하기 위한 메서드도 정의하고 있다.
```

### 1. 스토리지 생명 주기와 범위

1. 로컬 스토리지

   - 로컬 스토리지를 통해 저장된 데이터는 만료기한이 없고, 웹 애플리케이션이 삭제되기 전이나 사용자가 브라우저의 특정 인터페이스를 통해 삭제하기전까지는 사용자의 컴퓨터에 존재하므로 영구적으로 저장된다고 할 수 있다.
   - 로컬 스토리지의 범위는 문서의 출처에 국한된다. 문서의 출처는 프로토콜과 호스트명, 포트 등에 의해 정의된다.
   - 같은 출처의 모든 문서들은 한 로컬 스토리지 데이터를 공유한다. 이때, 실제로 로컬 스토리지에 접근하는 스크립트의 출처와는 상관없이 공유할 수 있다. 문서의 출처가 동일하다면 서로의 데이터를 읽을 수 있으며, 덮어 쓸 수도 있다. 그러나 출처가 다른 문서들은 두 문서가 동일한 서드파티 서버의 스크립트를 실행한다 하더라도, 서로의 데이터를 읽거나 덮어 쓸 수 없다.

2. 세션 스토리지
   - 세션 스토리지를 통해 저장된 데이터는 최상위 창이나 해당 스크립트를 실행하는 브라우저의 탭과 생명 주기가 같다. 창이나 탭이 닫히면, 세션 스토리지를 통해 저장된 데이터는 삭제된다.
   - 로컬 스토리지처럼 세션 스토리지도 문서의 출처에 따라 범위가 제한된다. 한편 세션 스토리지는 개별 창에 기반을 둔 범위를 가지기도 한다.

### 2. 스토리지 API

1. setItem()
2. getItem()
3. removeItem()
4. clear()
   - 모두 삭제
5. key()
   - key(0) ~ key(length-1)
6. 주의점 객체나 배열의 값은 일반적으로 변경이 가능하므로, 스토리지 객체는 해당 객체의 복사본을 생성한다. 이어서 원본 값을 변경하더라도 저장된 값에는 영향을 미치지 않는다. 스토리지 객체는 값을 가져올 때도 복사본을 생성하므로, 가져온 값을 변경해도 저장된 값에는 영향을 주지 않는다.

### 3. 스토리지 이벤트

로컬 스토리지나 세션 스토리지에 저장된 데이터가 변경될 때마다, **_브라우저는 이 데이터를 사용하는 다른 Window 객체에 스토리지 이벤트를 발생시킨다.(그러나, 이 변경을 일으킨 창에는 이벤트를 발생시키지 않는다.)_**  
**_브라우저에 동일 출처의 페이지를 표시하는 두 개의 탭이 존재하고 하나의 페이지에서 로컬 스토리지에 값을 저장했다면, 다른 탭에서는 스토리지 이벤트를 받게 된다._**

# 쿠키

쿠키는 웹브라우저에 의해 저장되는 이름을 가진 작은 크기의 데이터이며, 웹 페이지 또는 사이트에 한정된 스토리지다. 쿠키는 본래 서버 측 프로그래밍을 위해 설계되었으며 저수준 HTTP 프로토콜의 확장 기능으로 구현되었다. **_쿠키 데이터는 웹브라우저와 서버 사이에서 자동으로 전송되므로, 서버 측 스크립트는 클라이언트에서 저장한 쿠키의 값을 읽거나 쓸 수 있다._**

### 1. 쿠키 속성: 생명주기와 범위

1. 쿠키의 생명 주기와 범위를 제어하는 속성도 존재한다. 기본적으로 쿠키는 일시적인 것이다. 즉 쿠키는 웹브라우저 세션에 머무는 동안 마지막으로 저장한 값이지만, 사용자가 브라우저를 종료하면 모든 값이 사라진다. **_쿠키는 하나의 창에 제한되지 않으며, 기본적으로 생명주기도 어떤 하나의 창에 국한되지 않고 전체 브라우저의 생명 주기와 같다._**  
   이전에 종료된 단일 브라우저 세션의 쿠키가 계속 유지되게 하려면, max-age 속성을 지정하여(초 단위) 쿠키가 지속될 수 있도록 브라우저에 알려야 한다. 생명주기를 지정하면, 브라우저는 쿠키를 파일로 저장하고 유효기간이 만료되어야 비로소 삭제한다.
2. 쿠키의 범위는 로컬 스토리지와 세션 스토리지가 그러하듯 문서의 출처와 경로에 의해 제한된다. 이 범위는 쿠키의 경로와 도메인 속성을 통해 설정할 수 있다. 쿠키는 쿠키를 생성한 웹 페이지와 연결되어 접근 가능하며, 같은 디렉터리 또는 하위 디렉터리의 다른 웹 페이지에서도 마찬가지다.
   - ```
        http://www.example.com/catalog/index.html 쿠키 생성
        http://www.example.com/catalog/order.html 쿠키 사용 가능
        http://www.example.com/catalog/widgets/index.html 쿠키 사용 가능
        http://www.example.com/about.html 쿠키 사용 불가 - 상위 디렉터리
     ```
   - 쿠키의 경로를 지정할 수 있고 경로 설정시 동일한 웹 서버의 페이지 URL이 특정 경로로 시작할 경우 쿠키를 공유할 수 있다.
     - 쿠키의 경로를 '/'로 설정하면 웹서버 http://www.example.com의 모든 페이지에서 해당 쿠키를 사용할 수 있다.
3. 기본적으로 쿠키는 문서의 출처로 범위가 제한되어 있다. **_그러나 큰 웹사이트에서는 서브 도메인들 사이에서 쿠키를 공유해야 할 수도 있다. 예를 들어, order.example.com 도메인의 서버가 catalog.example.com의 쿠키 값을 읽어야 할 수 있을 것이다. 이때는 domain 속성을 사용하면 된다. catalog.example.com의 페이지에서 path 속성은 '/'로, domain 속성은 '.example.com'으로 설정한 쿠키를 생성하면 된다._**
4. 쿠키의 속성 중 마지막으로, 쿠키의 값들이 어떤 방식으로 네트워크를 통해 전송되는지를 지정하는 secure라는 이름의 boolean 속성이 있다. 쿠키는 기본적으로 불안정하다. 즉, 일반적인 비보안 HTTP 연결을 통하여 전송된다. 그러나 쿠키의 secure 속성을 표시하면, 브라우저와 서버가 HTTPS나 다른 보안 프로토콜을 통해 연결되었을 때만 데이터를 전송한다.

### 1. 쿠키 저장하기

1. cookie 프로퍼티를 문자열 형식으로 설장하면 된다.
   - name=value
   - document.cookie = 'version=' + encodeURIComponent(document.lastModified);
2. 쿠키 값은 세미콜론이나 쉼표, 공백을 포함 할 수 없다. 그러므로 아마도 쿠키를 저장하기 전에 코어 자바스크립트 전역 함수인 encodeURIComponent()를 사용해 값을 인코딩해야 할 것이다.
3. 프로퍼티
   - max-age
   - path
   - domain
   - secure
   - ```
        document.cookie += 'max-age=1000; path=path; domain=domain; secure';
     ```
